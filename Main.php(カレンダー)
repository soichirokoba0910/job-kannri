<?php
  date_default_timezone_set('Asia/Tokyo');
  if(isset($_GET['ym'])){
    $ym = $_GET['ym'];
  }else{
    $ym =date('Y-m');
  }

  $timestamp = strtotime($ym.'-01');
  if($timestamp === false){
    $ym = date('Y-m');
    $timestamp = strotime($ym.'-01');
  }

  $today =date('Y-m-j');
  
  $html_title = date('Y月n月',$timestamp);

  $prev =date('Y-m',mktime(0,0,0,date('m',$timestamp)-1,1,date('Y',$timestamp)));
  $next =date('Y-m',mktime(0,0,0,date('m',$timestamp)+1,1,date('Y',$timestamp)));

  $day_count = date('t',$timestamp);

  $youbi = date('w',mktime(0,0,0,date('m',$timestamp),1,date('Y',$timestamp)));

  $weeks = [];
  $week ='';

  $week .= str_repeat('<td></td>', $youbi);
  for($day =1; $day<=$day_count;$day++,$youbi++){
   $date = $ym.'-'.$day;
   if($today == $date){
     $week .='<td class="today">' . $day;
   } else {
     $week .='<td>' .$day;
   } 
     $week .='</td>';

     if($youbi%7==6 || $day == $day_count){
       if($day == $day_count){
         $week .=str_repeat('<td></td>',6-($youbi%7));
       }

       $weeks[] ='<tr>'.$week.'</tr>';
       $week ='';
     }
  }
?>

<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <title>カレンダー仕事管理表トップ</title>
    <style>
      .container{
        font-family: 'Noto Sans JP',sans-serif;
        margin-top: 80px;
      }
      h3{
        margin-bottom: 30px;
        text-align: center;
      }
      th{
        height: 30px;
      }
      td{
        height: 100px;
        width: 100px;
        vertical-align: top;
      }
      .today{
        background-color: orange;
      }
      th:nth-of-type(1),td:nth-of-type(1){
        color: red;
      }
      th:nth-of-type(7),td:nth-of-type(7){
        color: blue;
      }
      table{
        border-collapse: collapse;
        width: 700px;
        margin-left: auto;
        margin-right: auto;    
      }
      .syuu td{
        height: 30px;
        text-align: center;
      }
      p{
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div class ="container">
      <h3><a href="?ym=<?php echo $prev; ?>">&lt;</a><?php echo $html_title; ?><a href="?ym=<?php echo $next; ?>">&gt;</a></h3>
     <p> <a href="#">新規登録</a></p>
      <table  border="1"  class="table table-bordered">
        <tr class="syuu">
          <td>日</td>
          <td>月</td>
          <td>火</td>
          <td>水</td>
          <td>木</td>
          <td>金</td>
          <td>土</td>
        </tr>
        <?php
          foreach($weeks as $week){
            echo $week;
          }
        ?>
      </table>
    </div>
  </body>
</html>
